{% extends "base.html" %}

{% block title %}{{ password.site_name }} - Password Manager{% endblock %}

{% block content %}
<div class="password-view">
    <div class="view-header">
        <h1>{{ password.site_name }}</h1>
        <div class="view-actions">
            <a href="{{ url_for('main.edit_password', id=password.id) }}" class="btn btn-secondary">Edit</a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
    
    <div class="password-details">
        {% if password.site_url %}
            <div class="detail-row">
                <label>Website:</label>
                <a href="{{ password.site_url }}" target="_blank" rel="noopener noreferrer">{{ password.site_url }}</a>
            </div>
        {% endif %}
        
        <div class="detail-row">
            <label>Username:</label>
            <span class="copyable" id="username-display">{{ password.username }}</span>
            <button type="button" class="btn-copy" id="copy-username-btn">Copy</button>
        </div>
        
        <div class="detail-row">
            <label>Password:</label>
            <span class="password-masked" id="password-display">••••••••</span>
            <button type="button" class="btn-toggle" id="toggle-password">Show</button>
            <button type="button" class="btn-copy" id="copy-password-btn">Copy</button>
        </div>
        
        {% if password.notes %}
            <div class="detail-row">
                <label>Notes:</label>
                <p class="notes">{{ password.notes }}</p>
            </div>
        {% endif %}
        
        <div class="detail-row metadata">
            <p>Created: {{ password.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
            <p>Last updated: {{ password.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
        </div>
    </div>
</div>

<!-- Store password securely in a hidden element with proper escaping -->
<script id="password-data" type="application/json">{{ decrypted_password | tojson }}</script>

<script>
    // Parse the password from JSON to properly handle special characters
    const decryptedPassword = JSON.parse(document.getElementById('password-data').textContent);
    let passwordVisible = false;
    
    document.getElementById('toggle-password').addEventListener('click', function() {
        const display = document.getElementById('password-display');
        
        if (passwordVisible) {
            display.textContent = '••••••••';
            this.textContent = 'Show';
        } else {
            display.textContent = decryptedPassword;
            this.textContent = 'Hide';
        }
        passwordVisible = !passwordVisible;
    });
    
    document.getElementById('copy-username-btn').addEventListener('click', function() {
        const username = document.getElementById('username-display').textContent;
        copyToClipboard(username);
    });
    
    document.getElementById('copy-password-btn').addEventListener('click', function() {
        copyToClipboard(decryptedPassword);
    });
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('Copied to clipboard!');
        }).catch(function(err) {
            console.error('Failed to copy: ', err);
        });
    }
</script>
{% endblock %}
