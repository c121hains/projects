{% extends "base.html" %}

{% block title %}{{ password.site_name }} - Password Manager{% endblock %}

{% block content %}
<div class="password-view">
    <div class="view-header">
        <h1>{{ password.site_name }}</h1>
        <div class="view-actions">
            <a href="{{ url_for('main.edit_password', id=password.id) }}" class="btn btn-secondary">Edit</a>
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>
    
    <div class="password-details">
        {% if password.site_url %}
            <div class="detail-row">
                <label>Website:</label>
                <a href="{{ password.site_url }}" target="_blank" rel="noopener noreferrer">{{ password.site_url }}</a>
            </div>
        {% endif %}
        
        <div class="detail-row">
            <label>Username:</label>
            <span class="copyable" data-copy="{{ password.username }}">{{ password.username }}</span>
            <button type="button" class="btn-copy" onclick="copyToClipboard('{{ password.username }}')">Copy</button>
        </div>
        
        <div class="detail-row">
            <label>Password:</label>
            <span class="password-masked" id="password-display">••••••••</span>
            <button type="button" class="btn-toggle" id="toggle-password" onclick="togglePassword()">Show</button>
            <button type="button" class="btn-copy" onclick="copyToClipboard(decryptedPassword)">Copy</button>
        </div>
        
        {% if password.notes %}
            <div class="detail-row">
                <label>Notes:</label>
                <p class="notes">{{ password.notes }}</p>
            </div>
        {% endif %}
        
        <div class="detail-row metadata">
            <p>Created: {{ password.created_at.strftime('%Y-%m-%d %H:%M') }}</p>
            <p>Last updated: {{ password.updated_at.strftime('%Y-%m-%d %H:%M') }}</p>
        </div>
    </div>
</div>

<script>
    const decryptedPassword = "{{ decrypted_password }}";
    let passwordVisible = false;
    
    function togglePassword() {
        const display = document.getElementById('password-display');
        const button = document.getElementById('toggle-password');
        
        if (passwordVisible) {
            display.textContent = '••••••••';
            button.textContent = 'Show';
        } else {
            display.textContent = decryptedPassword;
            button.textContent = 'Hide';
        }
        passwordVisible = !passwordVisible;
    }
    
    function copyToClipboard(text) {
        navigator.clipboard.writeText(text).then(function() {
            alert('Copied to clipboard!');
        }).catch(function(err) {
            console.error('Failed to copy: ', err);
        });
    }
</script>
{% endblock %}
